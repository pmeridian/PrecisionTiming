<draw>
plots t0_resolution t0_resolution_vs_pt t0_resolution_vs_eta t0_resolution_vs_mtdEnergy t0_resolution_vs_tof t0_resolution_vs_minDPhi \
      t0_minDPhi_vs_eta t0_resolution_vs_genDR t0_resolution_simhtof_vs_genDR t0_resolution_vs_deltatof \
      tmtd_resolution tmtd_resolution_vs_pt tmtd_resolution_vs_eta tmtd_resolution_vs_mtdEnergy tmtd_resolution_vs_minDPhi \
      neutrals_efficiency_minDR0p5_vs_pt neutrals_efficiency_minDR0p5_vs_eta neutrals_efficiency_vs_eta neutrals_abs_efficiency_vs_eta \
      neutrals_efficiency_minDR0p05_vs_pt neutrals_efficiency_minDR0p05_vs_eta \      
      t0_resolution_simhtof simt0_resolution delta_tof_vs_Rconv delta_tof_vs_dPhi delta_tof_vs_genPt \
      minDR_convR30 neutrals_efficiency_vs_convR_minDR0p1 neutrals_efficiency_vs_genPt_minDR0p1 mtdEsum_vs_convR genDR_vs_convR minDR_vs_convR \
      t0_resolution_simhtof_comp 
saveAs pdf png root
plugins 'rootlogon.C' 'gStyle->SetOptStat("")' \
        '$CMSSW_BASE/src/ExternalTools/FuriousPlotter/scripts/macros/FPCanvasStyle.C'

#outDir '/eos/user/s/spigazzi/www/precision_timing/TDR/neutrals/SinglePi0/0PU/'
#outDir '/eos/user/s/spigazzi/www/precision_timing/TDR/neutrals/SingleGamma/0PU/'
outDir '/eos/user/s/spigazzi/www/precision_timing/TDR/neutrals/SingleGamma/0PU_chi2best/ptgen_gt5/'
#outDir '/eos/user/s/spigazzi/www/precision_timing/TDR/neutrals/SingleGamma/200PU/'
</draw>

#input /eos/user/s/spigazzi/ntuples/MTD/TDR/neutrals_reco/singlepi0_0PU_mtd5.root neu_tree
#input /eos/user/s/spigazzi/ntuples/MTD/TDR/neutrals_reco/singlegamma_0PU_mtd5.root neu_tree
input /eos/user/s/spigazzi/ntuples/MTD/TDR/neutrals_reco/singlegamma_0PU_mtd5_chi2best.root neu_tree
#input /eos/user/s/spigazzi/ntuples/MTD/TDR/neutrals_reco/singlegamma_200PU_mtd5.root neu_tree 

tdr_lgt_header '1 < p_{T}^{#gamma} < 10 GeV. #LTPU#GT=0.'

full_selection 'mtdTime>0 && minSChi2<50 && minTChi2<5 && simh_recoh_clus_DR>0 && fabs(eta)<1.5 && gen_DR<0.5 && pt>1'

<t0_resolution>
histos t0
<t0>
        src= input
        var 'mtdTime-tof-genpv_t'
        cut= full_selection 
        bins 100 -0.2 0.2
        customize 'SetTitle(";t_{neu}^{0}-t_{vtx}^{gen};Events / (20 ps)")' 'Fit("gaus")'
</t0>
</t0_resolution>

<t0_resolution_simhtof>
description 'The quoted effective sigma is squared sum of the weighted sum of the two gaussian sigmas + 6 ps from impact position estimation + 8 ps from the vertex'
customize 'macro:FPCanvasStyle(this, "CMS", "(14 TeV)", 0, "Phase-2 Simulation", 1)'
legendHeader= tdr_lgt_header
legendXY 0.2 0.75 0.45 0.9
histos t0
<t0>
        src= input
        var 'mtdTime-simh_clus_tof-genpv_t-14.3*minDPhi*minDPhi'
        cut= full_selection
        bins 100 -0.15 -0.15
        legendEntry '#sigma_{t}^{eff} = %.0f%effsigma->GetParameter(0) #pm 2 ps' l
        customize 'SetTitle(";#Deltat_{0} (ns);Events / (20 ps)")' 'macro:gStyle->SetOptFit(0)' 'SetMaximum(480)' \
                  'macro:TF1* ft0 = new TF1("ft0", "gaus(0)+gaus(3)", -0.15, 0.15); ft0->SetNpx(100000); ft0->SetLineWidth(2)' \
                  'macro:ft0->SetParameters(100, 0, 0.03, 10, 0, 0.2)' 'Fit(ft0)'  \
                  'macro:TF1* effsigma = new TF1("effsigma", "pol0", 0, 1); effsigma->SetParameter(0, sqrt(pow((1000*ft0->GetParameter(2)*ft0->GetParameter(0)+1000*ft0->GetParameter(5)*ft0->GetParameter(3))/(ft0->GetParameter(0)+ft0->GetParameter(3)),2)+36+64))' 'GetXaxis()->SetRangeUser(-0.15, 0.15)'
</t0>
</t0_resolution_simhtof>

<t0_resolution_simhtof_comp>
histos uncorr corr
<uncorr>
        src= input
        var 'mtdTime-simh_clus_tof-genpv_t'
        cut= full_selection
        bins 100 -0.2 -0.2
        legendEntry '%.3f%funcorr->GetParameter(2)' l
        customize 'SetTitle(";t_{#gamma}^{0}-t_{vtx}^{gen};Events / (20 ps)")' \
                  'macro:TF1* funcorr = new TF1("funcorr", "gaus", -0.2, 0.2); funcorr->SetNpx(100000); funcorr->SetLineWidth(3)' 'Fit(funcorr)'
</uncorr>
<corr= uncorr>
        var 'mtdTime-simh_clus_tof-genpv_t-14.3*minDPhi*minDPhi'
        legendEntry '%.3f%fcorr->GetParameter(2)' l
        customize 'SetLineColor(kBlue+1)' 'macro:TF1* fcorr = new TF1("fcorr", "gaus", -0.2, 0.2); fcorr->SetNpx(100000); fcorr->SetLineWidth(3)' 'Fit(fcorr)'
</corr>        
</t0_resolution_simhtof_comp>

<simt0_resolution>
histos t0 corr
<t0>
        src= input
        var 'simh_clus_time-simh_clus_tof-genpv_t'
        cut= full_selection
        bins 1000 -0.2 0.2
        customize 'SetTitle(";t_{sim-hit}^{0}-t_{vtx}^{gen};Events / (20 ps)")'
</t0>
<corr= t0>
        var 'simh_clus_time-simh_clus_tof-genpv_t-14.3*minDPhi*minDPhi'
        customize+= 'SetLineColor(kCyan-8)'
</corr>
</simt0_resolution>

<t0_resolution_vs_pt>
histos t0
<t0>
        src= input
        operation 'FitSlicesY(neu_tree, 2)'
        var 'mtdTime-tof-genpv_t:pt'
        cut= full_selection
        bins 20 1 10 50 -1 1 
        customize 'SetTitle(";p_{T} (GeV);#sigma(t_{neu}^{0}-t_{vtx}^{gen})")' 'GetYaxis()->SetRangeUser(0.02, 0.07)'
        drawOptions PE
</t0>
</t0_resolution_vs_pt>

gendr_bins 0 0.0025 0.005 0.0075 0.01 0.0125 0.015 0.0175 0.02 0.0225 0.025 0.0275 0.03 0.04 0.05 0.06 0.1
<t0_resolution_vs_genDR>
histos t0
<t0>
        src= input
        operation 'FitSlicesY(neu_tree, 2)'
        var 'mtdTime-tof-genpv_t:gen_DR'
        cut= full_selection
        dbins gendr_bins 50 -1 1 
        customize 'SetTitle(";#DeltaR(gen, reco);#sigma(t_{neu}^{0}-t_{vtx}^{gen})")' 'GetYaxis()->SetRangeUser(0.02, 0.07)'
        drawOptions PE
</t0>
</t0_resolution_vs_genDR>

<t0_resolution_simhtof_vs_genDR>
histos t0
<t0>
        src= input
        operation 'FitSlicesY(neu_tree, 2)'
        var 'mtdTime-simh_clus_tof-genpv_t:gen_DR'
        cut= full_selection     
        dbins gendr_bins 50 -1 1 
        customize 'SetTitle(";#DeltaR(gen, reco);#sigma(t_{neu}^{0}-t_{vtx}^{gen})")' 'GetYaxis()->SetRangeUser(0.02, 0.07)'
        drawOptions PE
</t0>
</t0_resolution_simhtof_vs_genDR>

<t0_resolution_vs_eta= t0_resolution_vs_pt>
histos t0
<t0>
        var 'mtdTime-tof-genpv_t:fabs(eta)'
        bins 20 0 1.5 50 -1 1 
        customize 'SetTitle(";|#eta|;#sigma(t_{neu}^{0}-t_{vtx}^{gen})")' 'GetYaxis()->SetRangeUser(0.02, 0.07)'
</t0>
</t0_resolution_vs_eta>

<t0_resolution_vs_mtdEnergy= t0_resolution_vs_pt>
histos t0
<t0>
        var 'mtdTime-tof-genpv_t:mtdEnergy'
        bins 20 1 20 50 -1 1 
        customize 'SetTitle(";E_{MTD} (MeV);#sigma(t_{neu}^{0}-t_{vtx}^{gen})")' 'GetYaxis()->SetRangeUser(0.02, 0.07)'
</t0>
</t0_resolution_vs_mtdEnergy>

<t0_resolution_vs_tof= t0_resolution_vs_pt>
histos t0
<t0>
        var 'mtdTime-tof-genpv_t:tof'
        bins 20 3 10 50 -1 1 
        customize 'SetTitle(";T.o.f (ns);#sigma(t_{neu}^{0}-t_{vtx}^{gen})")' 'GetYaxis()->SetRangeUser(0.02, 0.07)'
</t0>
</t0_resolution_vs_tof>

<t0_resolution_vs_minDPhi= t0_resolution_vs_pt>
histos t0
<t0>
        var 'mtdTime-tof-genpv_t:minDPhi'
        bins 20 0 0.05 50 -1 1 
        customize 'SetTitle(";#Delta#phi(MTD, Neutral);#sigma(t_{neu}^{0}-t_{vtx}^{gen})")' 'GetYaxis()->SetRangeUser(0.02, 0.07)' \
                  'GetXaxis()->SetNdivisions(507)' 
</t0>
</t0_resolution_vs_minDPhi>

<t0_minDPhi_vs_eta= t0_resolution>
histos t0
<t0>
        var 'minDPhi:fabs(eta)'
        bins 20 0 1.5 0 0.05 
        customize 'SetTitle(";|#eta|;#Delta#phi(MTD, Neutral)")' 'GetYaxis()->SetRangeUser(0., 0.05)'
        drawOptions PE
</t0>
</t0_minDPhi_vs_eta>

# Sim hit
<tmtd_resolution>
histos tmtd
<tmtd>
        src= input
        var 'mtdTime-simh_clus_time'
        cut= full_selection
        #cut 'fabs(eta)<1.5 && minDR!=0 && minDR<0.1 && gen_DR<0.5  && simh_recoh_clus_DR<0.025'
        bins 400 -1 1
        customize 'SetTitle(";t_{neu}^{MTD}-t_{neu}^{gen};Events / (20 ps)")' 'Fit("gaus")'
</tmtd>
</tmtd_resolution>

<tmtd_resolution_vs_pt>
histos tmtd
<tmtd>
        src= input
        operation 'FitSlicesY(neu_tree, 2)'        
        var 'mtdTime-simh_clus_time:pt'
        cut= full_selection
        bins 20 1 10 50 -1 1 
        customize 'SetTitle(";p_{T} (GeV);#sigma(t_{neu}^{MTD}-t_{neu}^{gen})")' 'GetYaxis()->SetRangeUser(0.02, 0.07)'
        drawOptions PE
</tmtd>
</tmtd_resolution_vs_pt>

<tmtd_resolution_vs_eta= tmtd_resolution_vs_pt>
histos tmtd
<tmtd>
        var 'mtdTime-simh_clus_time:fabs(eta)'
        bins 20 0 1.5 50 -1 1 
        customize 'SetTitle(";|#eta|;#sigma(t_{neu}^{MTD}-t_{neu}^{gen})")' 'GetYaxis()->SetRangeUser(0.02, 0.07)'
</tmtd>
</tmtd_resolution_vs_eta>

<tmtd_resolution_vs_mtdEnergy= tmtd_resolution_vs_pt>
histos tmtd
<tmtd>
        var 'mtdTime-simh_clus_time:mtdEnergy'
        bins 20 1 20 50 -1 1 
        customize 'SetTitle(";E_{MTD} (MeV);#sigma(t_{neu}^{MTD}-t_{neu}^{gen})")' 'GetYaxis()->SetRangeUser(0.02, 0.07)'
</tmtd>
</tmtd_resolution_vs_mtdEnergy>

<tmtd_resolution_vs_minDPhi= tmtd_resolution_vs_pt>
histos tmtd
<tmtd>
        var 'mtdTime-simh_clus_time:fabs(simh_recoh_clus_DPhi)'
        bins 20 0 0.005 50 -1 1 
        customize 'SetTitle(";#Delta#phi(MTD, Neutral);#sigma(t_{neu}^{MTD}-t_{neu}^{gen})")' 'GetYaxis()->SetRangeUser(0.02, 0.07)' \
                  'GetXaxis()->SetNdivisions(507)' 
</tmtd>
</tmtd_resolution_vs_minDPhi>

# Reco eff
<neutrals_efficiency_minDR0p5_vs_pt>
legendHeader '#DeltaR(#gamma, MTD) < 0.5'
legendXY 0.3 0.6 0.7 0.9
histos eff
<eff>
        src= input        
        var 'fabs(mtdTime-simh_clus_time)<0.1 && simh_recoh_clus_DR>0 && simh_recoh_clus_DR<0.025 && minDR<0.5:pt'
        cut 'fabs(eta)<1.5 && gen_DR<0.1'
        bins 20 1 10 0 1
        customize 'SetTitle(";p_{T} (GeV);Efficiency")' 'GetYaxis()->SetRangeUser(0., 1.)'
        drawOptions PE
</eff>
</neutrals_efficiency_minDR0p5_vs_pt>

<neutrals_efficiency_minDR0p5_vs_eta= neutrals_efficiency_minDR0p5_vs_pt>
histos eff
<eff>
        var 'fabs(mtdTime-simh_clus_time)<0.1 && simh_recoh_clus_DR>0 && simh_recoh_clus_DR<0.025 && minDR<0.5:fabs(eta)'
        bins 20 0 1.5 0 1        
        customize 'SetTitle(";|#eta|;Efficiency")' 'GetYaxis()->SetRangeUser(0., 1.)'
</eff>
</neutrals_efficiency_minDR0p5_vs_eta>

<neutrals_efficiency_minDR0p05_vs_pt>
legendHeader '#DeltaR(#gamma, MTD) < 0.05'
legendXY 0.3 0.6 0.7 0.9
histos eff
<eff>
        src= input        
        var 'fabs(mtdTime-simh_clus_time)<0.1 && simh_recoh_clus_DR>0 && simh_recoh_clus_DR<0.025 && minDR<0.05:pt'
        cut 'fabs(eta)<1.5 && gen_DR<0.1'
        bins 20 1 10 0 1
        customize 'SetTitle(";p_{T} (GeV);Efficiency")' 'GetYaxis()->SetRangeUser(0., 1.)'
        drawOptions PE
</eff>
</neutrals_efficiency_minDR0p05_vs_pt>

<neutrals_efficiency_minDR0p05_vs_eta= neutrals_efficiency_minDR0p05_vs_pt>
histos eff
<eff>
        var 'fabs(mtdTime-simh_clus_time)<0.1 && simh_recoh_clus_DR>0 && simh_recoh_clus_DR<0.025 && minDR<0.05:fabs(eta)'
        bins 20 0 1.5 0 1        
        customize 'SetTitle(";|#eta|;Efficiency")' 'GetYaxis()->SetRangeUser(0., 1.)'
</eff>
</neutrals_efficiency_minDR0p05_vs_eta>

<neutrals_efficiency_vs_convR_minDR0p1= neutrals_efficiency_minDR0p05_vs_pt>
legendHeader '#DeltaR(#gamma, MTD) < 0.1'
legendXY 0.3 0.3 0.7 0.6
histos eff
<eff>
        var 'minDR<0.1 && minDR>0:mct_convRadius'
        cut 'fabs(eta)<1.5 && gen_DR<0.5'        
        bins 50 0 130 0 1        
        customize 'SetTitle(";R_{conv} (cm);Efficiency")' 'GetYaxis()->SetRangeUser(0., 1.)'
</eff>
</neutrals_efficiency_vs_convR_minDR0p1>

<neutrals_efficiency_vs_eta>
customize 'SetGrid()' 'macro:FPCanvasStyle(this, "CMS", "(14 TeV)", 0, "Phase-2 Simulation", 1)'
legendHeader= tdr_lgt_header
legendXY 0.2 0.65 0.6 0.9
histos eff effwtime effRconvOnly
<eff>
        src= input
        # var 'minDR<0.1 && minDR>0 && simh_recoh_clus_DR>0 && mct_convRadius<118.:gen_pt'
        # var 'fabs(minDEta)<0.05 && fabs(minDPhi)<0.15 && minDR>0 && simh_recoh_clus_DR>0:fabs(eta)'
        var 'mtdTime>0 && minSChi2<50 && minTChi2<5 && simh_recoh_clus_DR>0:fabs(eta)'
        cut 'fabs(eta)<1.5 && gen_DR<0.5 && pt>1'
        #cut 'fabs(eta)<1.5 && gen_pt>5'
        bins 20 0 1.5 0 1
        legendEntry '#gamma with MTD hit' 'l'        
        customize 'SetTitle(";|#eta|;Efficiency")' 'GetYaxis()->SetRangeUser(0., 1.)' 'SetLineColor(kCyan-8)' 'SetMarkerColor(kCyan-8)'
        drawOptions HIST
</eff>
<effwtime= eff>
        #var 'minDR<0.1 && minDR>0 && simh_recoh_clus_DR>0 && fabs(mtdTime-simh_clus_tof-genpv_t)<0.105 && mct_convRadius<118.:gen_pt'
        #var 'fabs(minDEta)<0.05 && fabs(minDPhi)<0.15 && minDR>0 && fabs(mtdTime-simh_clus_tof-genpv_t)<0.105 && simh_recoh_clus_DR>0:fabs(eta)'
        var 'mtdTime>0 && minSChi2<50 && minTChi2<5 && fabs(mtdTime-simh_clus_tof-genpv_t)<0.105 && simh_recoh_clus_DR>0:fabs(eta)'
        customize 'SetLineColor(kRed+1)' 'SetMarkerColor(kRed+1)'        
        legendEntry '#gamma with MTD hit, #Deltat<3#sigma_{t}' 'pl'
        drawOptions PE        
</effwtime>
<effRconvOnly= eff>
        var 'mct_convRadius<118:fabs(eta)'
        customize 'SetLineColor(kBlack)' 'SetMarkerColor(kBlack)'        
        legendEntry '#gamma with conversion in tracker or BTL.' 'pl'
        drawOptions PE        
</effRconvOnly>
</neutrals_efficiency_vs_eta>

<neutrals_efficiency_vs_eta_breakdown= neutrals_efficiency_vs_eta>
customize 'SetGrid()' 'macro:FPCanvasStyle(this, "CMS", "(14 TeV)", 0, "Phase-2 Simulation", 1)'
legendHeader '1 < p_{T}^{#gamma} < 10 GeV.'
legendXY 0.2 0.65 0.6 0.9
histos effRconvOnly effRconvTrk
effRconvOnly.legendEntry 'Converted #gamma, R#leq R_{BTL} ' 'pl'
effRconvOnly.customize+= 'SetTitle(";|#eta|; Probability")' 'GetYaxis()->SetRangeUser(0., 1.)'
<effRconvTrk= eff>
        var 'mct_convRadius>116.5 && mct_convRadius<118.5:fabs(eta)'
        customize 'SetLineColor(kGray+1)' 'SetMarkerColor(kGray+1)' 
        legendEntry 'Converted #gamma, R=R_{BTL} ' 'pl'
        drawOptions PE        
</effRconvTrk>
</neutrals_efficiency_vs_eta_breakdown>

# Absolute efficiency
<neutrals_abs_efficiency_vs_eta>
customize 'SetGrid()' 'macro:FPCanvasStyle(this, "CMS", "(14 TeV)", 0, "Phase-2 Simulation", 1)'
legendHeader= tdr_lgt_header
legendXY 0.3 0.6 0.7 0.9
histos eff effwtime
<gen>
        src spectra_genonly_sel_0PU.root eta_spectrum
</gen>
<eff>
        src+= input gen:neutrals_abs_efficiency_vs_eta.gen
        operation 'Div(neu_tree, gen)'
        var 'fabs(eta)'
        cut '20/23000.*(gen_DR<0.5 && pt>1 && mtdTime>0 && minSChi2<50 && minTChi2<5 && simh_recoh_clus_DR>0)'
        bins 20 0 1.5
        legendEntry '#DeltaR(#gamma, MTD)<0.1' 'l'        
        customize 'SetTitle(";|#eta|;Efficiency")' 'GetYaxis()->SetRangeUser(0., 1.)' 'SetLineColor(kCyan-8)' 'SetMarkerColor(kCyan-8)' \
                  'GetYaxis()->SetRangeUser(0, 1)'
        drawOptions HIST
</eff>
<effwtime= eff>
        var 'fabs(eta)'
        cut '20/23000.*(gen_DR<0.5 && pt>1 && mtdTime>0 && minSChi2<50 && minTChi2<5 && fabs(mtdTime-simh_clus_tof-genpv_t)<0.105 && simh_recoh_clus_DR>0)'
        customize 'SetLineColor(kRed+1)' 'SetMarkerColor(kRed+1)'
        legendEntry '#DeltaR(#gamma, MTD)<0.1 + #Deltat<3#sigma_{t}' 'pl'
        drawOptions PE
</effwtime>
</neutrals_abs_efficiency_vs_eta>

<neutrals_efficiency_vs_genPt_minDR0p1>
pads top ratio
<top>
customize 'SetGrid()' 'macro:FPCanvasStyle(this, "CMS", "(14 TeV)", 0, "Phase-2 Simulation", 1)' 'SetBottomMargin(0.)'
legendHeader= tdr_lgt_header
legendXY 0.3 0.6 0.7 0.9
size 0 0.3 1. 1.
histos eff effwtime effRconvOnly 
<eff>
        src= input
        # var 'minDR<0.1 && minDR>0 && simh_recoh_clus_DR>0 && mct_convRadius<118.:gen_pt'        
        #var 'fabs(minDEta)<0.05 && fabs(minDPhi)<0.15 && minDR>0 && simh_recoh_clus_DR>0 && mct_convRadius<118.:gen_pt'
        var 'mtdTime>0 && minSChi2<50 && minTChi2<5 && simh_recoh_clus_DR>0 && mct_convRadius<118.:gen_pt'
        cut 'fabs(eta)<1.5 && gen_DR<0.5 && pt>1'        
        bins 20 0 10 0 1
        legendEntry '#DeltaR(#gamma, MTD)<0.1' 'pl'        
        customize 'SetTitle(";;Efficiency")' 'GetYaxis()->SetRangeUser(0., 1.)' 'SetLineColor(kCyan-8)' 'SetMarkerColor(kCyan-8)'
</eff>
<effwtime= eff>
        #var 'minDR<0.1 && minDR>0 && simh_recoh_clus_DR>0 && fabs(mtdTime-simh_clus_tof-genpv_t)<0.105 && mct_convRadius<118.:gen_pt'
        #var 'fabs(minDEta)<0.05 && fabs(minDPhi)<0.15 && minDR>0 && fabs(mtdTime-simh_clus_tof-genpv_t)<0.105 && simh_recoh_clus_DR>0 && mct_convRadius<118.:gen_pt'
        var 'mtdTime>0 && minSChi2<50 && minTChi2<5 && fabs(mtdTime-simh_clus_tof-genpv_t)<0.105 && simh_recoh_clus_DR>0 && mct_convRadius<118.:gen_pt'
        customize 'SetLineColor(kRed+1)' 'SetMarkerColor(kRed+1)'        
        legendEntry '#DeltaR(#gamma, MTD)<0.1 + #Deltat<3#sigma_{t}' 'pl'
</effwtime>
<effRconvOnly= eff>
        var 'mct_convRadius<118:gen_pt'
        customize 'SetLineColor(kBlack)' 'SetMarkerColor(kBlack)'        
        legendEntry 'R_{conv} #leq R_{BTL}' 'pl'
</effRconvOnly>
</top>

<ratio>
customize 'SetGrid()' 'SetTopMargin(0.)' 'SetBottomMargin(0.4)'
size 0. 0 1. 0.3
histos r_eff r_effwtime
<r_eff>
        src num:neutrals_efficiency_vs_genPt_minDR0p1.top.eff den:neutrals_efficiency_vs_genPt_minDR0p1.top.effRconvOnly
        operation 'Div(num, den)'
        customize 'SetTitle(";p_{T}^{gen};Eff. Ratio")' 'GetYaxis()->SetRangeUser(0.6, 1.)' 'GetYaxis()->SetNdivisions(507)' \
                  'SetLineColor(kCyan-8)' 'SetMarkerColor(kCyan-8)' 
        drawOptions HIST
</r_eff>
<r_effwtime= r_eff>
        src num:neutrals_efficiency_vs_genPt_minDR0p1.top.effwtime den:neutrals_efficiency_vs_genPt_minDR0p1.top.effRconvOnly
        customize+= 'SetLineColor(kRed+1)' 'SetMarkerColor(kRed+1)'
</r_effwtime>
</ratio>
</neutrals_efficiency_vs_genPt_minDR0p1>

<neutrals_pfCand_mtdHit_DR>
customize 'SetLogy()'
histos dr
<dr>
        src= input        
        var 'minDR'
        cut 'fabs(eta)<1.5 && gen_DR<0.1 && fabs(mtdTime-simh_clus_time)<0.1 && simh_recoh_clus_DR>0'
        bins 200 0 1.
        customize 'SetTitle(";#DeltaR(#gamma, MTD);Efficiency")' 'SetMinimum(0.001)'
</dr>
</neutrals_pfCand_mtdHit_DR>

# converions
<minDR_vs_convR>
histos dr
<dr>
        src= input
        var 'minDR:mct_convRadius'
        cut 'fabs(eta)<1.5'
        bins 100 0 130 50 0 0.1
        customize 'SetTitle(";R_{conv} (cm);#DeltaR(#gamma, MTD);")' 'SetMinimum(0.001)'
        drawOptions 'COLZ'
</dr>
</minDR_vs_convR>

<genDR_vs_convR>
histos dr
<dr>
        src= input
        var 'gen_DR:mct_convRadius'
        cut 'fabs(eta)<1.5'
        bins 100 0 130 0 1. "S"
        customize 'SetTitle(";R_{conv} (cm);#DeltaR(#gamma, gen);")' 'SetMinimum(0.001)'
        drawOptions PE
</dr>
</genDR_vs_convR>

<nclus_vs_convR>
histos dr
<dr>
        src= input
        var 'Sum$(clus_neu_DR<0.5):mct_convRadius'
        cut 'fabs(eta)<1.5'
        bins 100 0 130 0 50. "S"
        customize 'SetTitle(";Number of cluster;#DeltaR(#gamma, gen);")' 'SetMinimum(0.001)'
        drawOptions PE
</dr>
</nclus_vs_convR>

<mtdEsum_vs_convR= nclus_vs_convR>
<dr>
        var 'Sum$(clus_energy):mct_convRadius'
        cut 'fabs(eta)<1.5 && clus_neu_DR<0.5'
        customize 'SetTitle(";R_{conv} (cm);#Sigma_{MTD} E (GeV)")' 'SetMinimum(0.001)'
</dr>
</mtdEsum_vs_convR>

<minDR_convR30>
histos dr
<dr>
        src= input
        var 'minDR'
        cut 'fabs(eta)<1.5 && gen_DR<0.5 && mct_convRadius<30 && minDR>0'
        bins 200 0 0.5
        customize 'SetTitle(";#DeltaR(#gamma, MTD);Events")' 'SetMinimum(0.001)'
</dr>
</minDR_convR30>

<delta_tof_vs_dPhi>
customize 'macro:FPCanvasStyle(this, "CMS", "(14 TeV)", 0, "Phase-2 Simulation", 1, 1)'
histos map dt
<map>
        src= input
        var 'simh_clus_time-simh_clus_tof-genpv_t:minDPhi'
        cut 'mtdTime>0 && minSChi2<50 && minTChi2<5 && simh_recoh_clus_DR>0 && fabs(eta)<1.5 && gen_DR<0.5 && pt>1 && mct_convRadius<118.'
        bins 200 -0.1 0.1 100 0 0.2
        customize 'SetTitle(";#Delta#phi(#gamma, MTD);#Delta ToF")' 'SetMinimum(0.001)' 'GetXaxis()->SetNdivisions(507)'
        drawOptions COLZ
</map>
<dt= map>
        bins 200 -0.1 0.1 0 1
        customize+= 'SetMarkerColor(kMagenta)' 'SetLineColor(kMagenta)'
        drawOptions PE
</dt>
</delta_tof_vs_dPhi>

<delta_tof_vs_Rconv>
histos map dt
<map>
        src= input
        var 'simh_clus_time-simh_clus_tof-genpv_t:mct_convRadius'
        cut= full_selection
        bins 118 0 118 100 0 1
        customize 'SetTitle(";R_{conv} (cm);ToF_{gen}-t_{sim}")'
        drawOptions COLZ
</map>
<dt>
        src= input
        var 'simh_clus_time-simh_clus_tof-genpv_t:mct_convRadius'
        cut= full_selection
        bins 118 0 118 0 1 "S"
        customize 'SetTitle(";R_{conv} (cm);ToF_{gen}-t_{sim}")' 'GetYaxis()->SetRangeUser(0, 0.03)'
        drawOptions PE
</dt>
</delta_tof_vs_Rconv>

<delta_tof_vs_genPt>
histos dt
<dt>
        src= input
        var 'simh_clus_time-simh_clus_tof-genpv_t:gen_pt'
        cut 'fabs(eta)<1.5 && gen_DR<0.5 && minDR>0 && minDR<0.1 && mct_convRadius<118.  && simh_recoh_clus_DR>0  && simh_recoh_clus_DR<0.025'
        bins 40 0 10 0 1 "S"
        customize 'SetTitle(";p_{T}^{gen} (GeV);ToF_{gen}-t_{sim}")'  'GetYaxis()->SetRangeUser(0, 1)'
        drawOptions PE
</dt>
</delta_tof_vs_genPt>

<t0_resolution_vs_deltatof>
histos res res_corr
<res>
        src= input
        #operation 'FitSlicesY(neu_tree, 2)'
        var 'mtdTime-simh_clus_tof-genpv_t:simh_clus_time-simh_clus_tof-genpv_t'
        cut 'fabs(eta)<1.5 && gen_DR<0.5 && minDR>0 && minDR<0.1 && mct_convRadius<118. && simh_recoh_clus_DR>0'
        bins 100 0 0.3 400 -1 1 
        customize 'SetTitle(";ToF_{gen}-t_{SIM} (ns);#Deltat_{0} (ns)")' 'SetMarkerStyle(0)'
        drawOptions SCAT
</res>
<res_corr= res>
        var 'mtdTime-simh_clus_tof-genpv_t-14.3*minDPhi*minDPhi:simh_clus_time-simh_clus_tof-genpv_t'
        customize+= 'SetMarkerColor(kBlue+1)'
</res_corr>
</t0_resolution_vs_deltatof>

<radiografy>
histos map
<map>
        src= input
        var 'mct_convRadius:mct_convZ'
        cut 'fabs(eta)<1.5 && gen_DR<0.5 && minDR>0 && minDR<0.1'
        bins 600 -300 300 240 0 120
        customize 'SetTitle(";z_{conv};R_{conv}")' 'SetMarkerStyle(0)'
        drawOptions P
</map>
</radiografy>

<frac_dt_gt200ps_vs_Rconv>
histos dt
<dt>
        src= input
        var 'simh_clus_time-simh_clus_tof-genpv_t>0.2:mct_convRadius'
        cut 'fabs(eta)<1.5 && gen_DR<0.5 && minDR>0 && minDR<0.1 && simh_recoh_clus_DR>0  && simh_recoh_clus_DR<0.025'
        bins 118 0 118 0 1
        customize 'SetTitle(";R_{conv} (cm);ToF_{gen}-t_{sim}")' 'GetYaxis()->SetRangeUser(0, 1.)'
        drawOptions PE
</dt>
</frac_dt_gt200ps_vs_Rconv>

